# 推送功能

推送功能是 DooPush 平台的核心，为您提供灵活强大的推送通知能力。支持多种推送类型、精准的目标选择、丰富的内容格式和详细的效果分析。

## 📨 推送概述

DooPush 支持以下推送功能：

- **多种推送类型** - 单推、批量、广播、定时推送
- **精准目标选择** - 设备、标签、分组、平台筛选
- **丰富内容格式** - 标题、内容、角标、自定义载荷
- **消息模板系统** - 可复用的推送模板
- **完整效果分析** - 推送统计和趋势分析

## 🚀 发送推送

### 访问推送发送页面

在左侧导航点击 **"发送推送"** 进入推送发送页面。

### 推送类型

#### 📱 单设备推送 (Single)
向指定的单个设备发送推送通知。

**适用场景**：
- 个性化通知
- 重要消息提醒
- 问题设备测试

**配置要求**：
- **设备 Token** - 目标设备的完整推送 Token
- 从设备管理页面获取或通过 SDK 上报

#### 📋 批量推送 (Batch)
向多个指定设备同时发送推送通知。

**适用场景**：
- 会员专享通知
- 特定用户群体消息
- A/B 测试

**配置要求**：
- **设备 Token 列表** - 多个设备 Token，用逗号分隔
- 最多支持 1000 个设备

**示例格式**：
```
token1,token2,token3
```

#### 🏷️ 标签推送 (Tags)
向拥有特定标签的设备发送推送通知。

**适用场景**：
- 用户分层推送（VIP、普通用户）
- 地域性推送（北京、上海用户）
- 兴趣推送（体育、科技爱好者）

**配置要求**：
- **标签条件** - 至少添加一个标签筛选条件
- 支持多个标签组合（AND 逻辑）

**标签格式**：
- `user_level = vip`
- `city = beijing`
- `interest = sports`

#### 📢 广播推送 (Broadcast)
向应用的所有活跃设备发送推送通知。

**适用场景**：
- 重要公告
- 系统维护通知
- 全用户活动

**配置选项**：
- **平台筛选** - 可选择 iOS、Android 或全部平台
- **厂商筛选** - Android 设备可按厂商筛选：
  - Google FCM（通用 Android 设备）
  - 华为 HMS（华为/荣耀设备）
  - 小米推送（小米/红米设备）
  - OPPO推送（OPPO/OnePlus设备）
  - VIVO推送（VIVO/iQOO设备）

#### 👥 分组推送 (Groups)
向特定设备分组发送推送通知。

**适用场景**：
- 基于规则的精准推送
- 复杂条件筛选
- 批量目标管理

**配置要求**：
- **设备分组** - 选择预先创建的设备分组
- 支持选择多个分组

### 推送内容

#### 📝 基本内容

**推送标题**：
- **要求**：必填，1-200个字符
- **作用**：推送通知的主标题
- **建议**：简洁明了，突出重点

**推送内容**：
- **要求**：必填，1-1000个字符
- **作用**：推送通知的详细内容
- **建议**：内容具体，包含行动指引

**角标数量**：
- **作用**：iOS 应用图标上的红色数字
- **格式**：正整数
- **默认**：不设置则保持原有角标

#### 🎯 高级配置

**自定义载荷 (Payload)**：
推送通知可携带自定义数据，用于应用内处理。

**基础载荷字段**：
- **action** - 动作类型（如 `open_page`、`open_url`）
- **url** - 跳转链接（如 `https://example.com`）
- **data** - 自定义数据（JSON 格式字符串）

**基础载荷示例**：
```json
{
  "action": "open_page",
  "url": "https://example.com/news/123",
  "data": "{\"page\":\"news\",\"id\":123}"
}
```

#### 🤖 Android 厂商特定参数

为了优化在不同 Android 厂商设备上的推送效果，DooPush 支持厂商特定的推送参数：

**华为 HMS 参数**：
- `importance` - 消息重要性等级（NORMAL/HIGH）
- `ttl` - 消息存活时间（秒）
- `collapse_key` - 消息分组标识

**小米推送参数**：
- `pass_through` - 透传消息模式（0/1）
- `notify_type` - 通知栏展示类型
- `time_to_live` - 消息存活时间（毫秒）

**OPPO推送参数**：
- `channel_id` - 通知渠道ID
- `category` - 消息分类（MARKETING/SERVICE）
- `notify_level` - 通知级别（1/2/16）

**VIVO推送参数**：
- `classification` - 消息分类（0运营消息/1系统消息）
- `notify_type` - 通知类型（1/2/3/4）
- `skip_type` - 跳转类型（1应用内/2网页/3指定页面/4Intent）
- `time_to_live` - 消息存活时间（秒）

**厂商参数示例**：
```json
{
  "action": "open_page",
  "url": "https://example.com/news/123",
  "xiaomi": {
    "pass_through": 0,
    "notify_type": 1,
    "time_to_live": 3600000
  },
  "oppo": {
    "channel_id": "important",
    "category": "SERVICE",
    "notify_level": 2
  },
  "vivo": {
    "classification": 1,
    "notify_type": 1,
    "skip_type": 1,
    "time_to_live": 3600
  }
}
```

### 使用消息模板

**选择模板**：
1. 点击 **"选择模板"** 按钮
2. 从模板列表中选择目标模板
3. 系统自动填充模板内容

**模板变量**：
- 如果模板包含变量（如 `{{username}}`），需要填写变量值
- 系统会自动替换变量生成最终内容

### 定时发送

**启用定时发送**：
1. 设置 **"定时发送时间"**
2. 选择未来的具体日期和时间
3. 推送将在指定时间自动发送

**注意事项**：
- 定时时间必须是未来时间
- 定时推送会创建定时任务，可在定时推送管理中查看
- 发送前可以取消或修改定时任务

### 发送操作

**立即发送**：
1. 填写完整的推送内容
2. 点击 **"立即发送"** 按钮
3. 确认发送后推送立即进入发送队列

**预览推送**：
- 发送前可预览推送效果
- 确认内容格式和显示效果

## ⏰ 定时推送

定时推送功能允许您预设推送任务，在指定时间自动发送，支持一次性和重复推送。

### 查看定时推送

在左侧导航点击 **"定时推送"** 进入定时推送管理页面。

**显示信息**：
- **推送标题** - 定时推送的标题
- **推送内容** - 推送的具体内容
- **目标类型** - 推送的目标类型（单推、批量、广播等）
- **执行时间** - 计划执行的时间
- **重复类型** - 一次性、每日、每周、每月
- **状态** - 待执行、运行中、已完成、失败、暂停

### 定时推送统计

页面顶部显示定时推送统计：
- **总任务数** - 所有定时推送任务数量
- **待执行** - 等待执行的任务数量
- **运行中** - 正在执行的任务数量
- **已完成** - 执行完成的任务数量
- **失败** - 执行失败的任务数量
- **暂停** - 被暂停的任务数量

### 创建定时推送

**创建步骤**：
1. 点击 **"创建定时推送"** 按钮
2. 填写推送内容（与普通推送相同）
3. 设置执行时间和重复规则
4. 点击 **"创建"** 按钮

**执行时间设置**：
- **首次执行时间** - 第一次执行的具体时间
- **时区** - 确认时区设置正确

**重复规则**：
- **一次性** - 仅执行一次
- **每日** - 每天同一时间执行
- **每周** - 每周同一天同一时间执行
- **每月** - 每月同一日同一时间执行

### 管理定时推送

**编辑任务**：
- 修改推送内容、执行时间、重复规则
- 只能编辑未执行或暂停状态的任务

**暂停/恢复任务**：
- **暂停** - 临时停止任务执行
- **恢复** - 重新激活暂停的任务

**删除任务**：
- 删除不需要的定时推送任务
- 删除后无法恢复

## 📊 推送历史

推送历史记录了所有推送活动的详细信息和执行结果。

### 查看推送历史

在左侧导航点击 **"推送历史"** 进入推送历史页面。

**显示信息**：
- **推送标题** - 推送消息的标题
- **推送内容** - 推送消息的内容（截取显示）
- **目标类型** - 推送的目标类型
- **发送时间** - 推送发送的时间
- **状态** - 发送中、成功、失败
- **目标设备数** - 推送覆盖的设备数量
- **成功数量** - 成功送达的设备数量

### 筛选和搜索

**状态筛选**：
- **全部** - 显示所有状态的推送
- **发送中** - 正在发送的推送
- **成功** - 发送成功的推送
- **失败** - 发送失败的推送

**平台筛选**：
- **全部** - 显示所有平台的推送
- **iOS** - 仅显示 iOS 平台推送
- **Android** - 仅显示 Android 平台推送
  - **FCM** - Google Firebase Cloud Messaging
  - **HMS** - 华为移动服务推送
  - **小米推送** - 小米设备专用推送
  - **OPPO推送** - OPPO设备专用推送
  - **VIVO推送** - VIVO设备专用推送

**搜索功能**：
- 支持按推送标题搜索
- 支持按推送内容搜索

### 查看推送详情

**推送详情信息**：
- **基本信息** - 标题、内容、发送时间
- **目标配置** - 推送类型、目标条件
- **发送结果** - 成功数量、失败数量、错误信息
- **载荷数据** - 自定义载荷内容

**操作功能**：
- **复用推送** - 基于历史推送创建新推送
- **查看错误** - 查看发送失败的详细原因

## 📈 推送统计

推送统计提供详细的推送效果分析和数据洞察。

### 查看推送统计

在左侧导航点击 **"推送统计"** 进入推送统计页面。

### 核心指标

#### 📊 推送概览
- **总推送数** - 累计发送的推送数量
- **成功率** - 推送成功送达的比例
- **平均日推送** - 每日平均推送数量
- **覆盖设备数** - 推送覆盖的设备总数

#### 👆 用户互动
- **点击率** - 用户点击推送通知的比例
- **打开率** - 用户打开应用的比例
- **转化率** - 用户完成目标行为的比例

#### ⏱️ 时间分析
- **最佳推送时段** - 效果最好的时间段
- **用户活跃时间** - 用户最活跃的时间分布
- **推送频率** - 推送发送的频率分析

### 趋势分析

**推送趋势图**：
- 近30天的推送数量趋势
- 成功率变化趋势
- 用户互动趋势

**平台对比**：
- iOS vs Android 推送效果对比
- Android 不同厂商推送效果对比（FCM、HMS、小米、OPPO、VIVO）
- 不同平台的用户行为差异分析

### 效果优化建议

**基于数据的建议**：
- 推送时间优化建议
- 推送频率调整建议
- 内容优化方向

## 📝 消息模板

消息模板功能帮助您创建可复用的推送内容，提高推送效率和内容一致性。

### 查看消息模板

在左侧导航点击 **"消息模板"** 进入模板管理页面。

**显示信息**：
- **模板名称** - 模板的识别名称
- **推送标题** - 模板的推送标题
- **推送内容** - 模板的推送内容（截取显示）
- **支持平台** - iOS、Android、全部
- **语言** - 模板的语言版本
- **状态** - 启用、禁用
- **创建时间** - 模板创建日期

### 创建消息模板

**创建步骤**：
1. 点击 **"创建模板"** 按钮
2. 填写模板基本信息
3. 设置模板变量（可选）
4. 点击 **"创建"** 按钮

**基本信息**：

#### 📝 模板名称
- **要求**：必填，1-100个字符
- **作用**：模板的识别名称
- **建议**：使用有意义的命名，如 `会员升级通知`、`订单确认消息`

#### 📱 支持平台
- **iOS** - 仅适用于 iOS 平台
- **Android** - 仅适用于 Android 平台
- **全部** - 适用于所有平台

#### 🌐 语言设置
- **中文** - 中文内容模板
- **英文** - 英文内容模板
- **其他** - 其他语言版本

#### 📄 推送内容
- **推送标题** - 模板的标题内容
- **推送内容** - 模板的详细内容
- **载荷数据** - 可选的自定义载荷（JSON 格式）

### 模板变量

**变量功能**：
模板支持变量替换，实现内容的动态化。

**变量语法**：
- 使用双大括号包围变量名：`{{变量名}}`
- 变量名只能包含字母、数字、下划线

**常用变量示例**：
```
尊敬的 {{username}}，您的订单 {{order_id}} 已确认。
```

**变量配置**：
- **变量名** - 变量的标识名称
- **变量描述** - 变量的用途说明
- **默认值** - 变量的默认值（可选）

### 使用模板

**在推送中使用**：
1. 在发送推送页面点击 **"选择模板"**
2. 选择合适的模板
3. 填写模板变量值（如有）
4. 系统自动生成最终推送内容

**模板渲染**：
- 系统会自动将变量替换为实际值
- 可以预览渲染后的效果

### 模板管理

**编辑模板**：
- 修改模板内容、变量配置
- 更新支持平台和语言设置

**复制模板**：
- 基于现有模板创建新模板
- 快速创建相似内容的模板

**预览模板**：
- 查看模板的实际显示效果
- 验证变量替换结果

**启用/禁用模板**：
- 控制模板的可用状态
- 禁用的模板不会在选择列表中显示

## 💡 推送最佳实践

### 内容优化

**标题建议**：
- 控制在 20-30 个字符内
- 突出核心信息和价值
- 使用动作词汇吸引点击

**内容建议**：
- 提供具体的行动指引
- 包含时间敏感性信息
- 个性化内容提高相关性

### 时间优化

**推送时机**：
- 基于用户活跃时间发送
- 避开用户休息时间
- 考虑用户所在时区

**频率控制**：
- 避免过度推送影响体验
- 根据用户偏好调整频率
- 重要消息优先级处理

### 目标优化

**精准定位**：
- 利用标签和分组功能
- 基于用户行为数据推送
- A/B 测试优化效果

**效果监控**：
- 持续监控推送数据
- 根据统计结果调整策略
- 优化推送时间和内容

## ❓ 常见问题

### Q: 推送失败的常见原因？
A: 主要原因包括设备 Token 失效、推送配置错误、设备离线、用户关闭推送权限等。

### Q: 如何提高推送点击率？
A: 优化推送内容、选择合适推送时间、精准用户定位、提供有价值的信息。

### Q: 定时推送可以取消吗？
A: 可以。未执行的定时推送可以编辑、暂停或删除。

### Q: 模板变量有数量限制吗？
A: 建议单个模板的变量数量不超过 10 个，确保内容清晰易维护。

### Q: 广播推送会影响所有用户吗？
A: 广播推送会发送给所有活跃设备，建议谨慎使用，确保内容对所有用户都有价值。

---

*推送功能是用户触达的重要手段，合理使用各项功能能够显著提升用户参与度和应用活跃度。*
